<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="mapme.biodiversity">
<title>Quickstart • mapme.biodiversity</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Quickstart">
<meta property="og:description" content="mapme.biodiversity">
<meta property="og:image" content="https://mapme-initiative.github.io/mapme.biodiversity/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary" data-bs-theme="dark"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">mapme.biodiversity</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.6.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="../articles/quickstart.html">Quickstart</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/introduction.html">Introduction</a>
    <a class="dropdown-item" href="../articles/installation.html">Installation</a>
    <a class="dropdown-item" href="../articles/terminology.html">Terminology</a>
    <a class="dropdown-item" href="../articles/workflow.html">Workflow</a>
    <a class="dropdown-item" href="../articles/contributing.html">Contributing</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-how-to-s">How To's</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-how-to-s">
    <a class="dropdown-item" href="../articles/output-wide.html">Transform output to wide</a>
    <a class="dropdown-item" href="../articles/nasa-firms.html">Use downloaded resources</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/mapme-initiative/mapme.biodiversity/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Quickstart</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/mapme-initiative/mapme.biodiversity/blob/HEAD/vignettes/quickstart.Rmd" class="external-link"><code>vignettes/quickstart.Rmd</code></a></small>
      <div class="d-none name"><code>quickstart.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>In the following we will demonstrate an idealized workflow based on a
subset of the WorldPop data set that is delivered together with this
package. You can follow along the code snippets below to reproduce the
results. Please note that to reduce the time it takes to process this
vignette, we will not download any resources from the internet. In a
real use case, thus processing time might substantially increase because
resources have to be downloaded and real portfolios might be larger than
the one created in this example.</p>
<p>This vignette assumes that you have already followed the steps in <a href="https://mapme-initiative.github.io/mapme.biodiversity/articles/installation.html">Installation</a>
and have familiarized yourself with the terminology used in the package.
If you are unfamiliar with the terminology used here, please head over
to the <a href="https://mapme-initiative.github.io/mapme.biodiversity/articles/terminology.html">Terminology</a>
article to learn about the most important concepts.</p>
<p>The idealized workflow for using <a href="https://mapme-initiative.github.io/mapme.biodiversity/index.html">mapme.biodiversity</a>
consists of the following steps:</p>
<ul>
<li>prepare your sf-object containing only geometries of type
<code>'POLYGON'</code> or <code>'MULTIPOLYGON'</code>
</li>
<li>decide which indicator(s) you wish to calculate and make the
required resource(s) available</li>
<li>conduct your indicator calculation, which adds a nested list column
to your portfolio object</li>
<li>continue your analysis in R or decide to export your results to a
spatial data format to use it with other geospatial software</li>
</ul>
</div>
<div class="section level2">
<h2 id="getting-started">Getting started<a class="anchor" aria-label="anchor" href="#getting-started"></a>
</h2>
<p>First, we will load the <a href="https://mapme-initiative.github.io/mapme.biodiversity/index.html">mapme.biodiversity</a> and the
<a href="https://r-spatial.github.io/sf/" class="external-link">sf</a> package for handling spatial vector data. For tabular
data handling, we will also load the <a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a> and
<a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a> packages. Then, we will read an internal GeoPackage
which includes the geometry of a protected area in the Dominican
Republic from the WDPA database.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mapme-initiative.github.io/mapme.biodiversity/index.html">mapme.biodiversity</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">aoi_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"sierra_de_neiba_478140.gpkg"</span>, package <span class="op">=</span> <span class="st">"mapme.biodiversity"</span><span class="op">)</span></span>
<span><span class="va">aoi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="va">aoi_path</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">aoi</span></span>
<span><span class="co">#&gt; Simple feature collection with 1 feature and 4 fields</span></span>
<span><span class="co">#&gt; Geometry type: MULTIPOLYGON</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: -71.80933 ymin: 18.57668 xmax: -71.33201 ymax: 18.69931</span></span>
<span><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span><span class="co">#&gt;   WDPAID            NAME     DESIG_ENG ISO3                           geom</span></span>
<span><span class="co">#&gt; 1 478140 Sierra de Neiba National Park  DOM MULTIPOLYGON (((-71.76134 1...</span></span></code></pre></div>
<p>The sf-object contains a single object of geometry type
<code>'MULTIPOLYGON'</code>. Each of these polygons will be processed
individually before the results are combined and returned. The
<code>sf</code> object also contains some metadata (e.g. its WDPAID and
its name), that will be retained throughout the complete workflow.</p>
</div>
<div class="section level2">
<h2 id="setting-standard-option">Setting standard option<a class="anchor" aria-label="anchor" href="#setting-standard-option"></a>
</h2>
<p>We use the <code><a href="../reference/mapme.html">mapme_options()</a></code> function and set some
arguments, such as the output directory, that are important to govern
the subsequent processing. For this, we create a temporary directory.
Internally, to save time on downloading when building this vignette, we
copied already existing files to that output location (code not shown
here).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">outdir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"mapme-resources"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">outdir</span>, showWarnings <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/mapme.html">mapme_options</a></span><span class="op">(</span></span>
<span>  outdir <span class="op">=</span> <span class="va">outdir</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The <code>outdir</code> argument points towards a directory on the
local file system of your machine. All downloaded resources will be
written to respective directories nested within <code>outdir</code>.</p>
<p>Once you request a specific resource for your portfolio, only those
files will be downloaded that are missing to match its spatio-temporal
extent. This behavior is beneficial, e.g. in case you share the
<code>outdir</code> between different projects to ensure that only
resources matching your current portfolio are returned.</p>
<p>The <code>verbose</code> logical controls whether or not the package
will print informative messages during the calculations. Note, that even
if set to <code>FALSE</code>, the package will inform users about any
potential errors or warnings.</p>
</div>
<div class="section level2">
<h2 id="getting-the-right-resources">Getting the right resources<a class="anchor" aria-label="anchor" href="#getting-the-right-resources"></a>
</h2>
<p>You can check which indicators are available via the
<code><a href="../reference/indicators.html">available_indicators()</a></code> function:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/indicators.html">available_indicators</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 25 × 3</span></span></span>
<span><span class="co">#&gt;    name                  description                                   resources</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                 <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                         <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> active_fire_counts    Number of detected fires by NASA FIRMS        <span style="color: #949494;">&lt;tibble&gt;</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> biome                 Areal statistics of biomes from TEOW          <span style="color: #949494;">&lt;tibble&gt;</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> deforestation_drivers Areal statistics of deforestation drivers     <span style="color: #949494;">&lt;tibble&gt;</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> drought_indicator     Relative wetness statistics based on NASA GR… <span style="color: #949494;">&lt;tibble&gt;</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> ecoregion             Areal statstics of ecoregions based on TEOW   <span style="color: #949494;">&lt;tibble&gt;</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> elevation             Statistics of elevation based on NASA SRTM    <span style="color: #949494;">&lt;tibble&gt;</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> fatalities            Number of fatalities by group of conflict ba… <span style="color: #949494;">&lt;tibble&gt;</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> gsw_change            Statistics of the surface water change layer… <span style="color: #949494;">&lt;tibble&gt;</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> gsw_occurrence        Areal statistic of surface water based on oc… <span style="color: #949494;">&lt;tibble&gt;</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> gsw_recurrence        Areal statistic of surface water based on re… <span style="color: #949494;">&lt;tibble&gt;</span> </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 15 more rows</span></span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/indicators.html">available_indicators</a></span><span class="op">(</span><span class="st">"population_count"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 3</span></span></span>
<span><span class="co">#&gt;   name             description                    resources       </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                          <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> population_count Statistic of population counts <span style="color: #949494;">&lt;tibble [1 × 5]&gt;</span></span></span></code></pre></div>
<p>Say, we are interested in the <code>population_count</code>
indicator. We can learn more about this indicator and its required
resources by using either of the commands below or, if you are viewing
the online version, head over to the <a href="https://mapme-initiative.github.io/mapme.biodiversity/reference/population_count.html">population_count</a>
documentation.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">?</span><span class="va">population_count</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/help.html" class="external-link">help</a></span><span class="op">(</span><span class="va">population_count</span><span class="op">)</span></span></code></pre></div>
<p>By inspecting the help page we learned that this indicator requires
the <code>worldpop</code> resource and it requires to specify two extra
arguments: the population statistic to calculate and the eninge to be
used for the calculation (learn more about engines <a href="https://mapme-initiative.github.io/mapme.biodiversity/articles/terminology.html">here</a>).</p>
<p>With that information at hand, we can start to retrieve the required
resource. We can learn about all available resources using the
<code><a href="../reference/resources.html">available_resources()</a></code> function:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/resources.html">available_resources</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 23 × 5</span></span></span>
<span><span class="co">#&gt;    name                             description             licence source type </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> chirps                           Climate Hazards Group … CC - u… https… rast…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> esalandcover                     Copernicus Land Monito… CC-BY … https… rast…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> fritz_et_al                      Drivers of deforestati… CC-BY … https… rast…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> gfw_emissions                    Global Forest Watch - … CC-BY … https… rast…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> gfw_lossyear                     Global Forest Watch - … CC-BY … https… rast…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> gfw_treecover                    Global Forest Watch - … CC-BY … https… rast…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> global_surface_water_change      Global Surface Water -… https:… https… rast…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> global_surface_water_occurrence  Global Surface Water -… https:… https… rast…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> global_surface_water_recurrence  Global Surface Water -… https:… https… rast…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> global_surface_water_seasonality Global Surface Water -… https:… https… rast…</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 13 more rows</span></span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/resources.html">available_resources</a></span><span class="op">(</span><span class="st">"worldpop"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 5</span></span></span>
<span><span class="co">#&gt;   name     description                                      licence source type </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> worldpop WorldPop - Unconstrained Global Mosaics 2000 - … CC-BY … https… rast…</span></span></code></pre></div>
<p>For the purpose of this vignette, we are going to download the
<code>worldpop</code> resource. We can get more detailed information
about a given resource, by using either of the commands below to open up
the help page. If you are viewing the online version of this
documentation, you can simply head over to the <a href="https://mapme-initiative.github.io/mapme.biodiversity/reference/worldpop.html">worldpop</a>
resource documentation.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">?</span><span class="va">worldpop</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/help.html" class="external-link">help</a></span><span class="op">(</span><span class="va">worldpop</span><span class="op">)</span></span></code></pre></div>
<p>We can now make the <code>worldpop</code> resource available for our
portfolio. We will use a common interface that is used for all
resources, called <code><a href="../reference/mapme.html">get_resources()</a></code>. We have to specify our
portfolio object and supply one or more resource functions with their
respective arguments. This will then download the matching resources to
the output directory specified earlier.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">aoi</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mapme.html">get_resources</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">aoi</span>, <span class="fu"><a href="../reference/worldpop.html">get_worldpop</a></span><span class="op">(</span>years <span class="op">=</span> <span class="fl">2010</span><span class="op">:</span><span class="fl">2015</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Skipping existing files in output directory.</span></span></code></pre></div>
<p>In case you want to download more than one resource, you can use the
same interface and the resources will be made available sequentially.
Required arguments for a resource are simply added as usual:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">aoi</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mapme.html">get_resources</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">aoi</span>,</span>
<span>  <span class="fu"><a href="../reference/worldpop.html">get_worldpop</a></span><span class="op">(</span>years <span class="op">=</span> <span class="fl">2010</span><span class="op">:</span><span class="fl">2015</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../reference/gfw_treecover.html">get_gfw_treecover</a></span><span class="op">(</span>version <span class="op">=</span> <span class="st">"GFC-2021-v1.9"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="calculate-specific-indicators">Calculate specific indicators<a class="anchor" aria-label="anchor" href="#calculate-specific-indicators"></a>
</h2>
<p>The next step consists of calculating specific indicators. Note that
each indicator requires one or more resources that were made available
via the <code><a href="../reference/mapme.html">get_resources()</a></code> function explained above. You will
have to re-run this function in every new R session, but note that data
that is already available will not be re-downloaded.</p>
<p>Here, we are going to calculate the <code>population_count</code>
indicator which is based on the <code>worldpop</code> resource. Since
the resource has been made available in the previous step, we can
continue requesting the calculation of our desired indicator. Note the
command below would issue an error in case a required resource has not
been made available via <code><a href="../reference/mapme.html">get_resources()</a></code> beforehand.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">aoi</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mapme.html">calc_indicators</a></span><span class="op">(</span><span class="va">aoi</span>, <span class="fu"><a href="../reference/population_count.html">calc_population_count</a></span><span class="op">(</span>engine <span class="op">=</span> <span class="st">"zonal"</span>, stats <span class="op">=</span> <span class="st">"sum"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Found a column named 'assetid'. Overwritting its values with a unique identifier.</span></span></code></pre></div>
<p>Now let’s take a look at the results. In addition to the metadata we
are already familiar with, we see that there is an additional column
called <code>population_count</code> which contains a
<code>tibble</code>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">aoi</span></span>
<span><span class="co">#&gt; Simple feature collection with 1 feature and 6 fields</span></span>
<span><span class="co">#&gt; Geometry type: MULTIPOLYGON</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: -71.80731 ymin: 18.57734 xmax: -71.33268 ymax: 18.69799</span></span>
<span><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 7</span></span></span>
<span><span class="co">#&gt;   WDPAID NAME            DESIG_ENG     ISO3  assetid population_count</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> <span style="text-decoration: underline;">478</span>140 Sierra de Neiba National Park DOM         1 <span style="color: #949494;">&lt;tibble [6 × 4]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1 more variable: geom &lt;MULTIPOLYGON [°]&gt;</span></span></span></code></pre></div>
<p>The indicator is represented as a nested-list column in our
<code>sf</code>-object that is named alike the requested indicator. For
our single asset, this column contains a tibble with 6 rows and four
columns. Let’s have a closer look at this object</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">aoi</span><span class="op">$</span><span class="va">population_count</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 4</span></span></span>
<span><span class="co">#&gt;   datetime   variable       unit  value</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 2010-01-01 population_sum count <span style="text-decoration: underline;">4</span>063.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 2011-01-01 population_sum count <span style="text-decoration: underline;">4</span>015.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 2012-01-01 population_sum count <span style="text-decoration: underline;">4</span>063.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 2013-01-01 population_sum count <span style="text-decoration: underline;">3</span>962.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 2014-01-01 population_sum count <span style="text-decoration: underline;">3</span>991.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 2015-01-01 population_sum count <span style="text-decoration: underline;">4</span>213.</span></span></code></pre></div>
<p>The tibble follows a standard output format, which is the same for
all indicators. Each indicator is represented as a tibble with the four
columns <code>datetime</code>, <code>variable</code>, <code>unit</code>,
and <code>value</code>. In case of the population indicator, the
variable is the sum of the population, its unit is a count and the value
column gives the actual number.</p>
<p>Let’s quickly visualize the results:</p>
<p><img src="quickstart_files/figure-html/plot-popcount-1.png" width="700"></p>
<p>If you wish to change the layout of an portfolio, you can use
<code><a href="../reference/portfolio.html">portfolio_long()</a></code> and <code><a href="../reference/portfolio.html">portfolio_wide()</a></code> (see the
respective <a href="https://mapme-initiative.github.io/mapme.biodiversity/articles/output-wide.html">online
tutorial</a>). Especially for large portfolios, it is usually a good
idea to keep the geometry information in a separated variable to keep
the size of the data object relatively small.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">geoms</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">aoi</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/portfolio.html">portfolio_long</a></span><span class="op">(</span><span class="va">aoi</span>, drop_geoms <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 10</span></span></span>
<span><span class="co">#&gt;   WDPAID NAME  DESIG_ENG ISO3  assetid indicator datetime   variable unit  value</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> <span style="text-decoration: underline;">478</span>140 Sier… National… DOM         1 populati… 2010-01-01 populat… count <span style="text-decoration: underline;">4</span>063.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> <span style="text-decoration: underline;">478</span>140 Sier… National… DOM         1 populati… 2011-01-01 populat… count <span style="text-decoration: underline;">4</span>015.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> <span style="text-decoration: underline;">478</span>140 Sier… National… DOM         1 populati… 2012-01-01 populat… count <span style="text-decoration: underline;">4</span>063.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> <span style="text-decoration: underline;">478</span>140 Sier… National… DOM         1 populati… 2013-01-01 populat… count <span style="text-decoration: underline;">3</span>962.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> <span style="text-decoration: underline;">478</span>140 Sier… National… DOM         1 populati… 2014-01-01 populat… count <span style="text-decoration: underline;">3</span>991.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> <span style="text-decoration: underline;">478</span>140 Sier… National… DOM         1 populati… 2015-01-01 populat… count <span style="text-decoration: underline;">4</span>213.</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="enabling-parallel-computing">Enabling parallel computing<a class="anchor" aria-label="anchor" href="#enabling-parallel-computing"></a>
</h2>
<p><a href="https://mapme-initiative.github.io/mapme.biodiversity/index.html">mapme.biodiversity</a> follows the parallel computing
paradigm of the <a href="https://cran.r-project.org/package=future" class="external-link"><code>{future}</code></a>
package. That means that you as a user are in the control if and how you
would like to set up parallel processing. Since
<code>{mapme.biodiversity} v0.7</code> supports parallel processing on a
nested-level. The outer level applies parallel processing to the assets
in a portfolio, the inner level to potential chunks for polygons that
are larger than the specified chunks size or the single components of
assets of type <code>MULTIPOLYGON</code>.</p>
<p>The maximum chunk size is specified in hectares via
<code><a href="../reference/mapme.html">mapme_options()</a></code> and defaults to 100,000 ha. Polygons larger
than this threshold will be split into chunks of roughly the same
size.</p>
<p>Fine-control of parallel processing is given by using future
topologies (find more information <a href="https://cran.r-project.org/package=future/vignettes/future-3-topologies.html" class="external-link">here</a>).
To process all assets sequentially, but allow to spawn up to 4 workers
to process chunks in parallel you might specify:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://future.futureverse.org" class="external-link">future</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">sequential</span>, <span class="fu"><a href="https://future.futureverse.org/reference/tweak.html" class="external-link">tweak</a></span><span class="op">(</span><span class="va">cluster</span>, workers <span class="op">=</span> <span class="fl">6</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>As another example, with the code below one would apply parallel
processing of 2 assets, with each having 4 workers available to process
chunks, thus requiring a total of 8 available cores on the host machine.
Be sure to not request more workers than available on your machine.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://progressr.futureverse.org" class="external-link">progressr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://future.futureverse.org/reference/tweak.html" class="external-link">tweak</a></span><span class="op">(</span><span class="va">cluster</span>, workers <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://future.futureverse.org/reference/tweak.html" class="external-link">tweak</a></span><span class="op">(</span><span class="va">cluster</span>, workers <span class="op">=</span> <span class="fl">4</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://progressr.futureverse.org/reference/with_progress.html" class="external-link">with_progress</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">aoi</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mapme.html">calc_indicators</a></span><span class="op">(</span></span>
<span>    <span class="va">aoi</span>,</span>
<span>    <span class="fu"><a href="../reference/treecover_area_and_emissions.html">calc_treecover_area_and_emissions</a></span><span class="op">(</span></span>
<span>      min_size <span class="op">=</span> <span class="fl">1</span>,</span>
<span>      min_cover <span class="op">=</span> <span class="fl">30</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="va">sequential</span><span class="op">)</span> <span class="co"># close child processes</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="exporting-an-portfolio-object">Exporting an portfolio object<a class="anchor" aria-label="anchor" href="#exporting-an-portfolio-object"></a>
</h2>
<p>You can use the <code><a href="../reference/portfolio.html">write_portfolio()</a></code> function to save a
processed portfolio object to disk as a <code>GeoPackage</code> or any
other spatial format supported by GDAL. This allows sharing your data
with contributors who might not be using R, but any other geospatial
software. Simply point towards a non-existing file on your local disk to
write the portfolio. You can chose between serializing in the long or
wide data layout.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dsn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".gpkg"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/portfolio.html">write_portfolio</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">aoi</span>, dsn <span class="op">=</span> <span class="va">dsn</span>, format <span class="op">=</span> <span class="st">"long"</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">from_disk</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="va">dsn</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">from_disk</span></span>
<span><span class="co">#&gt; Simple feature collection with 6 features and 10 fields</span></span>
<span><span class="co">#&gt; Geometry type: MULTIPOLYGON</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: -71.80731 ymin: 18.57734 xmax: -71.33268 ymax: 18.69799</span></span>
<span><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span><span class="co">#&gt;   WDPAID            NAME     DESIG_ENG ISO3 assetid        indicator   datetime</span></span>
<span><span class="co">#&gt; 1 478140 Sierra de Neiba National Park  DOM       1 population_count 2010-01-01</span></span>
<span><span class="co">#&gt; 2 478140 Sierra de Neiba National Park  DOM       1 population_count 2011-01-01</span></span>
<span><span class="co">#&gt; 3 478140 Sierra de Neiba National Park  DOM       1 population_count 2012-01-01</span></span>
<span><span class="co">#&gt; 4 478140 Sierra de Neiba National Park  DOM       1 population_count 2013-01-01</span></span>
<span><span class="co">#&gt; 5 478140 Sierra de Neiba National Park  DOM       1 population_count 2014-01-01</span></span>
<span><span class="co">#&gt; 6 478140 Sierra de Neiba National Park  DOM       1 population_count 2015-01-01</span></span>
<span><span class="co">#&gt;         variable  unit    value                           geom</span></span>
<span><span class="co">#&gt; 1 population_sum count 4063.447 MULTIPOLYGON (((-71.76202 1...</span></span>
<span><span class="co">#&gt; 2 population_sum count 4015.088 MULTIPOLYGON (((-71.76202 1...</span></span>
<span><span class="co">#&gt; 3 population_sum count 4063.247 MULTIPOLYGON (((-71.76202 1...</span></span>
<span><span class="co">#&gt; 4 population_sum count 3961.917 MULTIPOLYGON (((-71.76202 1...</span></span>
<span><span class="co">#&gt; 5 population_sum count 3991.399 MULTIPOLYGON (((-71.76202 1...</span></span>
<span><span class="co">#&gt; 6 population_sum count 4212.674 MULTIPOLYGON (((-71.76202 1...</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; [1] TRUE</span></span></code></pre>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="http://dariusgoergen.com/" class="external-link">Darius A. Görgen</a>, Om Prakash Bhandari.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
