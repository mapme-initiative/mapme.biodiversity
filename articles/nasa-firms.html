<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="mapme.biodiversity">
<title>How To: Use downloaded resources • mapme.biodiversity</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="How To: Use downloaded resources">
<meta property="og:description" content="mapme.biodiversity">
<meta property="og:image" content="https://mapme-initiative.github.io/mapme.biodiversity/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">mapme.biodiversity</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/quickstart.html">Quickstart</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/introduction.html">Introduction</a>
    <a class="dropdown-item" href="../articles/installation.html">Installation</a>
    <a class="dropdown-item" href="../articles/terminology.html">Terminology</a>
    <a class="dropdown-item" href="../articles/workflow.html">Workflow</a>
    <a class="dropdown-item" href="../articles/contributing.html">Contributing</a>
  </div>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-how-to-s">How To's</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-how-to-s">
    <a class="dropdown-item" href="../articles/output-wide.html">Transform output to wide</a>
    <a class="dropdown-item" href="../articles/nasa-firms.html">Use downloaded resources</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/mapme-initiative/mapme.biodiversity/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="nasa-firms_files/htmlwidgets-1.6.2/htmlwidgets.js"></script><script src="nasa-firms_files/rglPlayer-binding-1.1.3/rglPlayer.js"></script><link href="nasa-firms_files/rglwidgetClass-1.1.3/rgl.css" rel="stylesheet">
<script src="nasa-firms_files/rglwidgetClass-1.1.3/rglClass.src.js"></script><script src="nasa-firms_files/rglwidgetClass-1.1.3/utils.src.js"></script><script src="nasa-firms_files/rglwidgetClass-1.1.3/buffer.src.js"></script><script src="nasa-firms_files/rglwidgetClass-1.1.3/subscenes.src.js"></script><script src="nasa-firms_files/rglwidgetClass-1.1.3/shaders.src.js"></script><script src="nasa-firms_files/rglwidgetClass-1.1.3/shadersrc.src.js"></script><script src="nasa-firms_files/rglwidgetClass-1.1.3/textures.src.js"></script><script src="nasa-firms_files/rglwidgetClass-1.1.3/projection.src.js"></script><script src="nasa-firms_files/rglwidgetClass-1.1.3/mouse.src.js"></script><script src="nasa-firms_files/rglwidgetClass-1.1.3/init.src.js"></script><script src="nasa-firms_files/rglwidgetClass-1.1.3/pieces.src.js"></script><script src="nasa-firms_files/rglwidgetClass-1.1.3/draw.src.js"></script><script src="nasa-firms_files/rglwidgetClass-1.1.3/controls.src.js"></script><script src="nasa-firms_files/rglwidgetClass-1.1.3/selection.src.js"></script><script src="nasa-firms_files/rglwidgetClass-1.1.3/rglTimer.src.js"></script><script src="nasa-firms_files/rglwidgetClass-1.1.3/pretty.src.js"></script><script src="nasa-firms_files/rglwidgetClass-1.1.3/axes.src.js"></script><script src="nasa-firms_files/rglwidgetClass-1.1.3/animation.src.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>How To: Use downloaded resources</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/mapme-initiative/mapme.biodiversity/blob/HEAD/vignettes/nasa-firms.Rmd" class="external-link"><code>vignettes/nasa-firms.Rmd</code></a></small>
      <div class="d-none name"><code>nasa-firms.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p><a href="https://mapme-initiative.github.io/mapme.biodiversity/index.html">mapme.biodiversity</a> can be used to simply download a
number of spatial resources and then conduct a custom analysis with that
data. This tutorial shows how to access the downloaded data and
conducting a small example analysis. For the scope of this tutorial, we
are interested in analyzing fire intensities in the Serengeti National
Park (NP), Tanzania. We are going to use
<a href="https://mapme-initiative.github.io/mapme.biodiversity/index.html">mapme.biodiversity</a> to download a fire detection product
based on the MODIS satellites distributed by NASA and then conduct a
fairly simple analysis of fire intensities within the national park.</p>
</div>
<div class="section level2">
<h2 id="downloading-data">Downloading data<a class="anchor" aria-label="anchor" href="#downloading-data"></a>
</h2>
<p>First, we start by loading the required packages needed for the
analysis.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/dmurdoch/rgl" class="external-link">rgl</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/" class="external-link">purrr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-quantities.github.io/units/" class="external-link">units</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://stringr.tidyverse.org" class="external-link">stringr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://spatstat.org/" class="external-link">spatstat</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org" class="external-link">lubridate</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mapme-initiative.github.io/mapme.biodiversity/index.html">mapme.biodiversity</a></span><span class="op">)</span></span></code></pre></div>
<p>Next, we create a directory to write our data to. We keep the path to
this directory in a variable, because we are going to need it later to
access the data.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_dir</span> <span class="op">&lt;-</span> <span class="st">"assets/data"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">data_dir</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span>, showWarnings <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>We are using the <a href="https://prioritizr.github.io/wdpar/" class="external-link">wdpar</a> package to download the data
base of protected areas in Tanzania and then subset it to the Serengeti
NP. Note, that we cast the geometry to <code>"POLYGON"</code> because
that type of geometry is actually expected by
<a href="https://mapme-initiative.github.io/mapme.biodiversity/index.html">mapme.biodiversity</a>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">wdpa_fetch</span><span class="op">(</span><span class="st">"Tanzania"</span>, download_dir <span class="op">=</span> <span class="va">data_dir</span><span class="op">)</span></span>
<span><span class="va">aoi</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span><span class="va">data</span><span class="op">$</span><span class="va">NAME</span> <span class="op">==</span> <span class="st">"Serengeti National Park"</span>, <span class="op">]</span></span>
<span><span class="va">aoi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_cast.html" class="external-link">st_cast</a></span><span class="op">(</span><span class="va">aoi</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span>, <span class="st">"POLYGON"</span><span class="op">)</span></span></code></pre></div>
<p>In the next code chunk, we initiate a portfolio with the geometry of
the Serengeti NP specifying the temporal extent we are interested in -
here the years 2010 to 2020 - as well as the output directory where the
data will be downloaded to.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">aoi</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/init_portfolio.html">init_portfolio</a></span><span class="op">(</span><span class="va">aoi</span>, years <span class="op">=</span> <span class="fl">2010</span><span class="op">:</span><span class="fl">2020</span>, outdir <span class="op">=</span> <span class="va">data_dir</span><span class="op">)</span></span></code></pre></div>
<p>We are now ready to actually download the data. Note, that running
the next code chunk actually takes significant time because the
<code>nasa_firms</code> resource is a rather large data set.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">aoi</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_resources.html">get_resources</a></span><span class="op">(</span><span class="va">aoi</span>, <span class="st">"nasa_firms"</span>, instrument <span class="op">=</span> <span class="st">"MODIS"</span><span class="op">)</span></span></code></pre></div>
<p>The <code>nasa_firms</code> data set as processed by the
<a href="https://mapme-initiative.github.io/mapme.biodiversity/index.html">mapme.biodiversity</a> package is collection of points stored
in a GeoPackage for each year of observation indicating the detection of
a fire with an associated confidence level of the detection. Follow the
resources linked in <code><a href="../reference/nasa_firms.html">help(nasa_firms)</a></code> to find out more about
the data.</p>
<p>After the download has completed, we can find the data in the
<code>data_dir</code> we specified earlier when constructing the
portfolio. There will be a new subfolder for each requested resource
with the same name.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gpkgs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">data_dir</span>, <span class="st">"nasa_firms"</span><span class="op">)</span>,</span>
<span>  pattern <span class="op">=</span> <span class="st">".gpkg"</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="va">nasa_firms</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map_dfr.html" class="external-link">map_dfr</a></span><span class="op">(</span><span class="va">gpkgs</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">read_sf</a></span><span class="op">(</span><span class="va">x</span>, wkt_filter <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_text.html" class="external-link">st_as_text</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sfc.html" class="external-link">st_as_sfc</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">st_bbox</a></span><span class="op">(</span><span class="va">aoi</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="va">nasa_firms</span> <span class="op">&lt;-</span> <span class="va">nasa_firms</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_binary_pred.html" class="external-link">st_contains</a></span><span class="op">(</span><span class="va">aoi</span>, <span class="va">nasa_firms</span><span class="op">)</span><span class="op">)</span>, <span class="op">]</span></span></code></pre></div>
<p>Since the <code>nasa_firms</code> data is a global data set but we
are only interested in the fires observed in the Serengeti NP, we apply
one filter when reading in the data to contain only points within the
bounding box of our AOI. Then we apply another filter to subset to
points that actually fall within the polygon.</p>
<p>That’s it! We actually accessed the original data that the
<a href="https://mapme-initiative.github.io/mapme.biodiversity/index.html">mapme.biodiversity</a> package downloaded for us. Now we can
work with that data in a way that is suitable for our analysis. Follow
along if you want to learn how the <code>nasa_firms</code> resource can
be used to map fire intensity within the Serengeti NP!</p>
</div>
<div class="section level2">
<h2 id="eda-of-fire-events">EDA of fire events<a class="anchor" aria-label="anchor" href="#eda-of-fire-events"></a>
</h2>
<p>First, let’s take a look at what we have. We select a confidence
value of 50 to include only those detection with a higher probability of
actually representing a fire event. Then, we construct a new variable
representing the year of the observation and finally create a plot
showing the spatio-temporal distribution of fire events in the Serengeti
NP.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nasa_firms</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">nasa_firms</span>, <span class="va">confidence</span> <span class="op">&gt;</span> <span class="fl">50</span><span class="op">)</span></span>
<span><span class="va">nasa_firms</span><span class="op">$</span><span class="va">year</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/year.html" class="external-link">year</a></span><span class="op">(</span><span class="va">nasa_firms</span><span class="op">$</span><span class="va">acq_date</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">aoi</span>, inherit.aes <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">nasa_firms</span>, alpha <span class="op">=</span> <span class="fl">.1</span>, color <span class="op">=</span> <span class="st">"#f18e26"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">coord_sf</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">34.0</span>, to <span class="op">=</span> <span class="fl">35.0</span>, by <span class="op">=</span> <span class="fl">.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">year</span>, nrow <span class="op">=</span> <span class="fl">2</span>, switch <span class="op">=</span> <span class="st">"x"</span><span class="op">)</span></span></code></pre></div>
<p><img src="nasa-firms_files/figure-html/map-data-1.png" width="864"></p>
<p>Visually, it seems there is a gradient with higher numbers of fires
detected in the North-East of the National Park towards lower numbers in
the South-West of the park. Also, during some years substantially fewer
fires seem to occur compared to other years.</p>
<p>Let’s confirm that last observation by plotting a barplot of the
numbers of fires for every years. We find the most fires occurred during
2016 and 2020 while the lowest numbers were observed in 2017 and 2011.
The difference between the highest and lowest observed fires is 1270
fires while the average number of fires per year is 853</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nasa_firms</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span>, fill <span class="op">=</span> <span class="st">"#f18e26"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Year"</span>, y <span class="op">=</span> <span class="st">"Count of fire events"</span><span class="op">)</span></span></code></pre></div>
<p><img src="nasa-firms_files/figure-html/fires-year-1.png" width="864"></p>
<p>We now take a closer look at the intra-annual distribution of fires.
For that, again, we construct a new variable indicating the month a
certain observation was made.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nasa_firms</span><span class="op">$</span><span class="va">month</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="va">nasa_firms</span><span class="op">$</span><span class="va">acq_date</span><span class="op">)</span>, <span class="st">"%b"</span><span class="op">)</span>,</span>
<span>  labels <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/month.html" class="external-link">month</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">12</span>, label <span class="op">=</span> <span class="cn">TRUE</span>, abbr <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">nasa_firms</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">month</span><span class="op">)</span>, fill <span class="op">=</span> <span class="st">"#f18e26"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Month"</span>, y <span class="op">=</span> <span class="st">"Count of fire events"</span><span class="op">)</span></span></code></pre></div>
<p><img src="nasa-firms_files/figure-html/fires-month-1.png" width="864"></p>
<p>We see that there is a very clear seasonal pattern in the occurrences
of fires with most fires observed in the months of June and July. During
February and September there are also substantiall numbers of fires
observer, but fewer than during the fire season. We now might look at
the intra-annual distribution from a different angle by dividing a year
into quarters starting with the month of March using the meteorological
division of a year.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nasa_firms</span><span class="op">$</span><span class="va">quarter</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/quarter.html" class="external-link">quarter</a></span><span class="op">(</span><span class="va">nasa_firms</span><span class="op">$</span><span class="va">acq_date</span>, fiscal_start <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="va">nasa_firms</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>quarter <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Q"</span>, <span class="va">quarter</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">quarter</span><span class="op">)</span>, fill <span class="op">=</span> <span class="st">"#f18e26"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Quarter"</span>, y <span class="op">=</span> <span class="st">"Count of fire events"</span><span class="op">)</span></span></code></pre></div>
<p><img src="nasa-firms_files/figure-html/fires-quarter-1.png" width="864"></p>
<p>From this perspective, the most relevant quarter for analyzing fires
in the Serengeti NP seems to be the second one spanning the months June,
July, and August. We thus filter the data to only include fire
observations from the second quarter and ignore the rest for the scope
of this tutorial. Again, let’s have a spatial visualization of the data
we are going to work with now.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nasa_firms</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">nasa_firms</span>, <span class="va">quarter</span> <span class="op">==</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">aoi</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">nasa_firms</span>, alpha <span class="op">=</span> <span class="fl">.1</span>, color <span class="op">=</span> <span class="st">"#f18e26"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">34.0</span>, to <span class="op">=</span> <span class="fl">35.0</span>, by <span class="op">=</span> <span class="fl">.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">year</span>, nrow <span class="op">=</span> <span class="fl">2</span>, switch <span class="op">=</span> <span class="st">"x"</span><span class="op">)</span></span></code></pre></div>
<p><img src="nasa-firms_files/figure-html/filter-data-1.png" width="864"></p>
</div>
<div class="section level2">
<h2 id="kernel-based-intensity-estimation">Kernel-based intensity estimation<a class="anchor" aria-label="anchor" href="#kernel-based-intensity-estimation"></a>
</h2>
<p>From the visual interpretation of the data we might conclude that the
occurrence of fire events is spatially clustered with a tendency of more
fires observed in the North-East compared to the South-West. Imagine we
wanted to highlight areas where park rangers could watch emerging fires
more closely in order to prevent them from burning too large an area.
One approach to produce such an map is to use a kernel-based estimation
of the intensity of an observed point pattern. The <a href="https://cran.r-project.org/package=spatstat" class="external-link"><code>spatstat</code></a>
package provides a ton of functionality to work with point patterns, one
of which allows an empirical estimation of the intensity surface. For
that, we need to transform our data into a planar coordinate system and
plug it into a <code>spatstat</code> specific point-pattern object.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">center</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html" class="external-link">st_coordinates</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html" class="external-link">st_centroid</a></span><span class="op">(</span><span class="va">aoi</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">laea</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span>  <span class="st">"+proj=laea +lat_0="</span>, <span class="va">center</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>  <span class="st">" +lon_0="</span>, <span class="va">center</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="st">" +x_0=0 +y_0=0"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">aoi_laea</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">aoi</span>, crs <span class="op">=</span> <span class="va">laea</span><span class="op">)</span></span>
<span><span class="va">fires_laea</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">nasa_firms</span>, crs <span class="op">=</span> <span class="va">laea</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ppp_fires</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/spatstat.geom/man/as.ppp.html" class="external-link">as.ppp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sfc.html" class="external-link">st_as_sfc</a></span><span class="op">(</span><span class="va">aoi_laea</span><span class="op">)</span>, <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sfc.html" class="external-link">st_as_sfc</a></span><span class="op">(</span><span class="va">fires_laea</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ppp_fires</span><span class="op">)</span></span>
<span><span class="co">#&gt; Planar point pattern:  7361 points</span></span>
<span><span class="co">#&gt; Average intensity 5.646643e-07 points per square unit</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coordinates are given to 3 decimal places</span></span>
<span><span class="co">#&gt; i.e. rounded to the nearest multiple of 0.001 units</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Window: polygonal boundary</span></span>
<span><span class="co">#&gt; single connected closed polygon with 401 vertices</span></span>
<span><span class="co">#&gt; enclosing rectangle: [-101678.14, 53378.67] x [-109059.06, 101908.44] units</span></span>
<span><span class="co">#&gt;                      (155100 x 211000 units)</span></span>
<span><span class="co">#&gt; Window area = 13036100000 square units</span></span>
<span><span class="co">#&gt; Fraction of frame area: 0.399</span></span></code></pre></div>
<p>The summary of the Planar Point Pattern object shows some important
information. First, there are 7361 points to begin with. These are
distributed in an observation window which is constituted by the shape
of the Serengeti NP and has a size of 13094316275 m². Thus, we obtain an
average intensity for the whole national park of 5.62152299153907e-07
1/m² or 0.5622 1/km².</p>
<p>Let’s now test our assumption that the point pattern of fires
observed shows a tendency to clustering. For this we use
<code>spatstat</code> to estimate Ripley’s K function (see <a href="http://book.spatstat.org/sample-chapters/chapter07.pdf" class="external-link">here</a>
for more information). The K function compares an observed point pattern
to a simulation of a number of patterns that are the product of a
process showing complete spatially randomness (CSR). The statistic is a
count of the number of neighboring points within an increasing distance
<em>r</em> from each point in both the observed pattern an the simulated
ones. Comparing the two, simply put, allows to draw conclusions about
the behavior of the observed pattern at certain distances. If the
observed number of points at a specific distance is higher than the
expected one under CSR, the points tend to cluster together at that
distance. On the other hand, if there are less points in the spatial
neighborhood of a point than expected under CSR, there is an indication
of inhibition between points.</p>
<p>Note, that the estimation of K assumes that the point process is
stationary - that is the intensity of fire events is homogeneous within
the observation window. If intensity is in- homogeneous, we cannot be
sure if the clustering is a result of the spatially varying intensity
(first order effect) or because points attract each other to form
clusters (second order effect). Since we are not interested in drawing
conclusions about the process generating the observed pattern in this
tutorial, we can accept this caveat.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">k_env</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/spatstat.explore/man/envelope.html" class="external-link">envelope</a></span><span class="op">(</span><span class="va">ppp_fires</span>, <span class="va">Kest</span>,</span>
<span>  nsim <span class="op">=</span> <span class="fl">99</span>, correction <span class="op">=</span> <span class="st">"border"</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">k_env</span><span class="op">)</span></span></code></pre></div>
<p><img src="nasa-firms_files/figure-html/fire-density-1.png" width="864"></p>
<p>We see that for the largest part of varying the distance <em>r</em>,
the observed pattern seems to be more clustered than a CSR process
(note, the units of <em>r</em> are meters). For very large values of
<em>r</em> the observed pattern is within the expected range of CSR.</p>
<p>We now are interested in producing a map of estimated intensity which
informs us about the areas where fires are more likely to occur. For
this we are using a kernel-based empirical estimation of the observed
intensity. That means we are moving a kernel over the point pattern and
calculate the empirical intensity within the current kernel. The main
challenge here is to determine a bandwidth parameter <em>sigma</em> that
best fits the data. The standard approach in <code>spatstat</code> is to
solely determine <em>sigma</em> based on the size and the shape of the
observation window. We might achieve a better visualization with a
customized value for <em>sigma</em>. Since the point pattern shows a
tendency towards clustering, we apply a simple heuristic to derive a
value for <em>sigma</em>. We calculate the difference between the
observed K and the K values under CSR. Then, we determine at which
spatial distance <em>r</em> the difference between the two is maximal.
To get <em>sigma</em> we than simply take half the value of that
distance.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">diff</span> <span class="op">&lt;-</span> <span class="va">k_env</span><span class="op">$</span><span class="va">obs</span> <span class="op">-</span> <span class="va">k_env</span><span class="op">$</span><span class="va">theo</span></span>
<span><span class="va">sigma</span> <span class="op">&lt;-</span> <span class="va">k_env</span><span class="op">$</span><span class="va">r</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html" class="external-link">which.max</a></span><span class="op">(</span><span class="va">diff</span><span class="op">)</span><span class="op">]</span> <span class="op">/</span> <span class="fl">2</span></span></code></pre></div>
<p>This indicates that the distance between the observed and simulated K
is maximal at a distance of 14050 so that our bandwidth for the kernel
estimation of the intensity is 7025. We can now use the
<code><a href="https://rdrr.io/r/stats/density.html" class="external-link">density()</a></code> function to apply a kernel-based estimation of
intensity with our custom sigma value.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dens_emp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/density.html" class="external-link">density</a></span><span class="op">(</span><span class="va">ppp_fires</span>, sigma <span class="op">=</span> <span class="va">sigma</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">dens_emp</span>, ribbon <span class="op">=</span> <span class="cn">FALSE</span>, addcontour <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="nasa-firms_files/figure-html/densities-sigma-1.png" width="864"></p>
<p>Let’s make a quick sanity check if the empirical intensity matches
the point pattern. For that, remember that the units for the intensity
is fires per m². We thus need to multiply the sum of the pixel values by
their spatial resolution.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="va">dens_emp</span><span class="op">$</span><span class="va">xstep</span> <span class="op">*</span> <span class="va">dens_emp</span><span class="op">$</span><span class="va">ystep</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">dens_emp</span><span class="op">)</span> <span class="op">*</span> <span class="va">res</span></span>
<span><span class="co">#&gt; [1] 7384.578</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">nasa_firms</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 7361</span></span></code></pre></div>
<p>While not being actual identical values, the kernel-based estimate of
the number of events is close enough to the observed one. We now might
also include a 3D animation of the intensity surface to allow an even
better investigation.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">map2color</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">pal</span>, <span class="va">limits</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">x</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">pal</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/findInterval.html" class="external-link">findInterval</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="va">limits</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">limits</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, length.out <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">pal</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>    all.inside <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span><span class="op">]</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">pal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/colorRamp.html" class="external-link">colorRampPalette</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"blue"</span>, <span class="st">"yellow"</span>, <span class="st">"red"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">cols</span> <span class="op">&lt;-</span> <span class="fu">map2color</span><span class="op">(</span><span class="va">dens_emp</span><span class="op">$</span><span class="va">v</span>,</span>
<span>  pal <span class="op">=</span> <span class="fu">pal</span><span class="op">(</span><span class="fl">100</span><span class="op">)</span>,</span>
<span>  limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">dens_emp</span><span class="op">$</span><span class="va">v</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">dens_emp</span><span class="op">$</span><span class="va">v</span>, <span class="fl">.75</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://dmurdoch.github.io/rgl/dev/reference/persp3d.html" class="external-link">persp3d</a></span><span class="op">(</span><span class="va">dens_emp</span><span class="op">$</span><span class="va">v</span>,</span>
<span>  col <span class="op">=</span> <span class="va">cols</span>, xlab <span class="op">=</span> <span class="st">"X"</span>, ylab <span class="op">=</span> <span class="st">"Y"</span>, zlab <span class="op">=</span> <span class="st">"Fire Intensity"</span>,</span>
<span>  main <span class="op">=</span> <span class="st">"Fire intensity for Q2"</span>, aspect <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">.65</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">control</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dmurdoch.github.io/rgl/dev/reference/par3dinterpControl.html" class="external-link">par3dinterpControl</a></span><span class="op">(</span><span class="fu"><a href="https://dmurdoch.github.io/rgl/dev/reference/spin3d.html" class="external-link">spin3d</a></span><span class="op">(</span>axis <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>, <span class="fl">0</span>, <span class="fl">12</span>, steps <span class="op">=</span> <span class="fl">40</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://dmurdoch.github.io/rgl/dev/reference/rglwidget.html" class="external-link">rglwidget</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dmurdoch.github.io/rgl/dev/reference/playwidget.html" class="external-link">playwidget</a></span><span class="op">(</span><span class="va">control</span>, step <span class="op">=</span> <span class="fl">0.01</span>, loop <span class="op">=</span> <span class="cn">TRUE</span>, rate <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Combining widgets requires the 'manipulateWidget' package.</span></span></code></pre></div>
<div id="rgl-play36031" style="width:864px;height:40px;" class="rglPlayer html-widget "></div>
<script type="application/json" data-for="rgl-play36031">{"x":{"actions":[{"type":"propertySetter","value":0,"values":[1,0,0,0,0.3420201433256682,-0.9396926207859085,0.9396926207859085,0.3420201433256682,0.9876883405951378,0.05350373815413399,-0.1470003124348961,-0.1564344650402309,0.3378093078114404,-0.9281234452935301,0.9396926207859085,0.3420201433256682,0.9510565162951535,0.1056900367061867,-0.2903809893115787,-0.3090169943749474,0.3252804860140791,-0.8937007903129089,0.9396926207859085,0.3420201433256682,0.8910065241883679,0.1552738957894115,-0.426611522512159,-0.4539904997395467,0.304742179107011,-0.8372722558519105,0.9396926207859085,0.3420201433256682,0.8090169943749475,0.2010343962337857,-0.5523374641860206,-0.5877852522924731,0.2767001083690208,-0.760227299704533,0.9396926207859085,0.3420201433256682,0.7071067811865476,0.2418447626479748,-0.6644630243886748,-0.7071067811865475,0.2418447626479749,-0.6644630243886749,0.9396926207859085,0.3420201433256682,0.5877852522924731,0.2767001083690208,-0.760227299704533,-0.8090169943749475,0.2010343962337857,-0.5523374641860206,0.9396926207859085,0.3420201433256682,0.4539904997395468,0.304742179107011,-0.8372722558519103,-0.8910065241883678,0.1552738957894115,-0.4266115225121591,0.9396926207859085,0.3420201433256682,0.3090169943749475,0.3252804860140791,-0.8937007903129089,-0.9510565162951535,0.1056900367061867,-0.2903809893115787,0.9396926207859085,0.3420201433256682,0.1564344650402311,0.3378093078114403,-0.92812344529353,-0.9876883405951377,0.05350373815413408,-0.1470003124348964,0.9396926207859085,0.3420201433256682,2.83276944882399e-16,0.3420201433256682,-0.9396926207859085,-1,9.68864212895355e-17,-2.661932547447669e-16,0.9396926207859085,0.3420201433256682,-0.1564344650402308,0.3378093078114404,-0.9281234452935301,-0.9876883405951378,-0.05350373815413396,0.1470003124348961,0.9396926207859084,0.3420201433256681,-0.3090169943749473,0.3252804860140791,-0.8937007903129091,-0.9510565162951536,-0.1056900367061867,0.2903809893115786,0.9396926207859085,0.3420201433256682,-0.4539904997395467,0.304742179107011,-0.8372722558519105,-0.8910065241883679,-0.1552738957894115,0.4266115225121589,0.9396926207859085,0.3420201433256682,-0.587785252292473,0.2767001083690208,-0.760227299704533,-0.8090169943749475,-0.2010343962337856,0.5523374641860205,0.9396926207859084,0.3420201433256681,-0.7071067811865475,0.2418447626479749,-0.6644630243886749,-0.7071067811865476,-0.2418447626479748,0.6644630243886748,0.9396926207859085,0.3420201433256682,-0.8090169943749473,0.2010343962337857,-0.5523374641860206,-0.5877852522924732,-0.2767001083690208,0.7602272997045328,0.9396926207859085,0.3420201433256682,-0.8910065241883678,0.1552738957894115,-0.4266115225121591,-0.4539904997395469,-0.304742179107011,0.8372722558519103,0.9396926207859085,0.3420201433256682,-0.9510565162951534,0.1056900367061869,-0.2903809893115792,-0.309016994374948,-0.3252804860140791,0.8937007903129088,0.9396926207859085,0.3420201433256682,-0.9876883405951377,0.05350373815413403,-0.1470003124348962,-0.156434465040231,-0.3378093078114403,0.92812344529353,0.9396926207859085,0.3420201433256682,-1,1.93772842579071e-16,-5.323865094895337e-16,-5.66553889764798e-16,-0.3420201433256682,0.9396926207859085,0.9396926207859085,0.3420201433256682,-0.9876883405951378,-0.05350373815413394,0.147000312434896,0.1564344650402307,-0.3378093078114404,0.9281234452935301,0.9396926207859085,0.3420201433256682,-0.9510565162951536,-0.1056900367061867,0.2903809893115786,0.3090169943749473,-0.3252804860140791,0.8937007903129091,0.9396926207859085,0.3420201433256682,-0.8910065241883679,-0.1552738957894115,0.4266115225121589,0.4539904997395467,-0.304742179107011,0.8372722558519105,0.9396926207859084,0.3420201433256681,-0.8090169943749476,-0.2010343962337856,0.5523374641860205,0.587785252292473,-0.2767001083690208,0.7602272997045331,0.9396926207859084,0.3420201433256681,-0.7071067811865477,-0.2418447626479748,0.6644630243886748,0.7071067811865475,-0.2418447626479749,0.664463024388675,0.9396926207859085,0.3420201433256682,-0.5877852522924732,-0.2767001083690208,0.7602272997045328,0.8090169943749473,-0.2010343962337857,0.5523374641860206,0.9396926207859085,0.3420201433256682,-0.4539904997395469,-0.304742179107011,0.8372722558519103,0.8910065241883678,-0.1552738957894116,0.4266115225121592,0.9396926207859085,0.3420201433256682,-0.3090169943749476,-0.3252804860140791,0.8937007903129089,0.9510565162951535,-0.1056900367061868,0.2903809893115789,0.9396926207859084,0.3420201433256681,-0.156434465040231,-0.3378093078114403,0.92812344529353,0.9876883405951377,-0.05350373815413404,0.1470003124348963,0.9396926207859084,0.3420201433256681,-1.83697019872103e-16,-0.3420201433256682,0.9396926207859085,1,-6.282808106515477e-17,1.726187340341776e-16,0.9396926207859085,0.3420201433256682,0.1564344650402307,-0.3378093078114404,0.9281234452935301,0.9876883405951378,0.05350373815413392,-0.1470003124348959,0.9396926207859085,0.3420201433256682,0.3090169943749472,-0.3252804860140791,0.8937007903129091,0.9510565162951536,0.1056900367061866,-0.2903809893115785,0.9396926207859085,0.3420201433256682,0.4539904997395466,-0.304742179107011,0.8372722558519106,0.891006524188368,0.1552738957894114,-0.4266115225121589,0.9396926207859085,0.3420201433256682,0.5877852522924729,-0.2767001083690208,0.7602272997045331,0.8090169943749476,0.2010343962337856,-0.5523374641860204,0.9396926207859085,0.3420201433256682,0.7071067811865474,-0.2418447626479749,0.664463024388675,0.7071067811865477,0.2418447626479748,-0.6644630243886747,0.9396926207859085,0.3420201433256682,0.8090169943749468,-0.201034396233786,0.5523374641860214,0.587785252292474,0.2767001083690206,-0.7602272997045324,0.9396926207859085,0.3420201433256682,0.8910065241883678,-0.1552738957894116,0.4266115225121592,0.453990499739547,0.304742179107011,-0.8372722558519103,0.9396926207859085,0.3420201433256682,0.9510565162951535,-0.1056900367061868,0.2903809893115789,0.3090169943749476,0.3252804860140791,-0.8937007903129089,0.9396926207859085,0.3420201433256682,0.9876883405951377,-0.05350373815413407,0.1470003124348964,0.1564344650402311,0.3378093078114403,-0.92812344529353,0.9396926207859085,0.3420201433256682,1,-3.87545685158142e-16,1.064773018979067e-15,1.133107779529596e-15,0.3420201433256682,-0.9396926207859085,0.9396926207859085,0.3420201433256682],"entries":[0,1,2,4,5,6,9,10],"properties":["userMatrix","userMatrix","userMatrix","userMatrix","userMatrix","userMatrix","userMatrix","userMatrix"],"objids":1,"param":[0,0.3,0.6,0.8999999999999999,1.2,1.5,1.8,2.1,2.4,2.7,3,3.3,3.6,3.9,4.2,4.5,4.8,5.1,5.399999999999999,5.7,6,6.3,6.6,6.899999999999999,7.199999999999999,7.5,7.8,8.1,8.4,8.699999999999999,9,9.299999999999999,9.6,9.9,10.2,10.5,10.8,11.1,11.4,11.7,12],"interp":true}],"start":0,"stop":12,"value":0,"interval":0.05,"rate":0.5,"components":["Reverse","Play","Slower","Faster","Reset","Slider","Label"],"buttonLabels":["Reverse","Play","Slower","Faster","Reset","Slider","Label"],"pause":"Pause","loop":true,"step":0.01,"labels":null,"precision":3,"reinit":null,"sceneId":"rgl87731","respondTo":null},"evals":[],"jsHooks":[]}</script>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="http://dariusgoergen.com/" class="external-link">Darius A. Görgen</a>, Om Prakash Bhandari.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
